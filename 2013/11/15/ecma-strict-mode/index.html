<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>
        
        严格模式 |
        
        GRAVE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <link rel="icon" href="/favicon.png">
    
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">GRAVE</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Living Life Over</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <!--<div id="search-form-wrap">-->
        <!--<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://yoursite.com"></form>-->
      <!--</div>-->
    </div>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/-net/">.net</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ecma-262/">ecma-262</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kendoui/">kendoui</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/veronica/">veronica</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发-团队/">开发 & 团队</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>

  
</aside>
      
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ecma-strict-mode" class="article article-type-post" itemscope
         itemprop="blogPost">

    <div class="dropdown toc-trigger">
        <a data-toggle="dropdown" href="#">目录</a>
        <div class="dropdown-menu pull-right" role="menu" aria-labelledby="dLabel">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#好处"><span class="toc-number">1.</span> <span class="toc-text">好处</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启用"><span class="toc-number">2.</span> <span class="toc-text">启用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#规则"><span class="toc-number">3.</span> <span class="toc-text">规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题"><span class="toc-number">4.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol>
        </div>
    </div>

    <div class="article-inner">
        

        
        <header class="article-header">
            
  
    <h1 class="article-title" itemprop="name">
      严格模式
    </h1>
  

        </header>
        

        <div class="article-meta">
            <a href="/2013/11/15/ecma-strict-mode/" class="article-date">
  <time datetime="2013-11-15T03:19:07.000Z" itemprop="datePublished">Nov 15 2013</time>
</a>
            
  <div class="article-category">
    <a class="article-category-link" href="/categories/ecma-262/">ecma-262</a>
  </div>

        </div>

        <hr/>

        <div class="article-entry" itemprop="articleBody">
            
            <p>ECMA-262 版本：5.1</p>
<h2 id="好处">好处</h2>
<ul>
<li>消除Javascript语法的一些不合理、不严谨之处，显式报错，减少一些怪异行为;</li>
<li>消除代码运行的一些不安全之处，保证代码运行的安全；</li>
<li>提高编译器效率，增加运行速度；</li>
<li>为未来新版本的Javascript做好铺垫。</li>
</ul>
<h2 id="启用">启用</h2>
<p>进入条件，在全局代码或函数内使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div></pre></td></tr></table></figure>

<h2 id="规则">规则</h2>
<p>规范中一共定义了21条规则</p>
<p><strong>有些保留字不能用作变量名</strong></p>
<p>“implements”, “interface”, “let”, “package”, “private”, “protected”, “public”, “static”, and “yield” </p>
<p><strong>八进制表示法不被允许</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> a = <span class="number">001</span>;</div></pre></td></tr></table></figure>

<p>SyntaxError</p>
<p><strong>OctalEscapeSequence 不被允许</strong></p>
<p>A conforming implementation, when processing strict mode code (see 10.1.1), may not extend the syntax of EscapeSequence to include OctalEscapeSequence as described in B.1.2.</p>
<p><strong>未定义变量会抛出 ReferenceError</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div><div class="line">a = <span class="number">1</span>; <span class="comment">// ReferenceError</span></div><div class="line"><span class="keyword">var</span> x = y = <span class="number">20</span>; <span class="comment">// also a ReferenceError</span></div></pre></td></tr></table></figure>

<p>但有种情况很特殊：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div><div class="line"><span class="keyword">this</span>.declared = <span class="number">10</span>; <span class="comment">// OK</span></div><div class="line"></div><div class="line">declared = <span class="number">20</span>; <span class="comment">// OK，全局作用域下，this === window，换句话说，本质上这个也是局部变量</span></div></pre></td></tr></table></figure>

<p>定义一个read-only属性</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> foo = <span class="built_in">Object</span>.defineProperty({}, {</div><div class="line">    bar: {</div><div class="line">        value: <span class="number">10</span>,</div><div class="line">        writable: <span class="literal">false</span></div><div class="line">    },</div><div class="line">    baz: {</div><div class="line">        get: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">            <span class="keyword">return</span> <span class="string">'baz is read-only property.'</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">});</div><div class="line"></div><div class="line">foo.bar = <span class="number">20</span>; <span class="comment">// TypeError</span></div><div class="line">foo.baz = <span class="number">20</span>; <span class="comment">// TypeError</span></div></pre></td></tr></table></figure>

<p>但是，如果属性是可配置的，那么就还是可以通过 Object.defineProperty 去修改的。如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> foo = <span class="built_in">Object</span>.defineProperty({}, <span class="string">'bar'</span>, {</div><div class="line">    value: <span class="number">10</span>,</div><div class="line">    writable: <span class="literal">false</span>,</div><div class="line">    configurable: <span class="literal">true</span></div><div class="line">});</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.defineProperty(foo, <span class="string">'bar'</span>, {</div><div class="line">    value: <span class="number">20</span></div><div class="line">});</div></pre></td></tr></table></figure>

<p>另外一种情况也可以改变 read-only 属性。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> foo = <span class="built_in">Object</span>.defineProperty({}, <span class="string">'bar'</span>, {</div><div class="line">    value: <span class="number">10</span>,</div><div class="line">    writable: <span class="literal">false</span></div><div class="line">});</div><div class="line"></div><div class="line"><span class="comment">// inherit from foo</span></div><div class="line"><span class="keyword">var</span> newFoo = <span class="built_in">Object</span>.create(foo);</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.defineProperty(newFoo, <span class="string">'bar'</span>, {</div><div class="line">    value: <span class="number">20</span></div><div class="line">});</div><div class="line">创建一个没有扩展的对象</div><div class="line"><span class="pi">"use strict"</span>;</div><div class="line"><span class="keyword">var</span> foo = {</div><div class="line">    bar: <span class="number">10</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.preventExtensions(foo);</div><div class="line"></div><div class="line">foo.bar = <span class="number">20</span>; <span class="comment">// TypeError</span></div></pre></td></tr></table></figure>

<p><strong>eval 和 arguments 是 关键字，不能成为左值</strong></p>
<p>也就是不能向它们赋值</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div><div class="line">　　<span class="built_in">arguments</span>++; <span class="comment">// 语法错误</span></div><div class="line">　　<span class="keyword">var</span> obj = { set p(<span class="built_in">arguments</span>) { } }; <span class="comment">// 语法错误</span></div><div class="line">　　<span class="keyword">try</span> { } <span class="keyword">catch</span> (<span class="built_in">arguments</span>) { } <span class="comment">// 语法错误</span></div><div class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">arguments</span><span class="params">()</span> </span>{ } <span class="comment">// 语法错误</span></div><div class="line">　　<span class="keyword">var</span> f = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"arguments"</span>, <span class="string">"'use strict'; return 17;"</span>); <span class="comment">// 语法错误</span></div></pre></td></tr></table></figure>

<p>Uncaught SyntaxError: Unexpected eval or arguments in strict mode</p>
<p><strong>不能访问 arguments 的 <code>caller</code> 和 <code>callee</code>，会抛出 TypeError</strong></p>
<p>这样在递归调用时只能使用函数的名称</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span><span class="params">()</span></span>{</div><div class="line"><span class="pi">　　"use strict"</span>;</div><div class="line">　　f1.caller; <span class="comment">// 报错</span></div><div class="line">　　f1.arguments; <span class="comment">// 报错</span></div><div class="line">}</div><div class="line">f1()</div></pre></td></tr></table></figure>

<p><strong>arguments 不再动态跟踪形参属性变化</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="list">(<span class="title">function</span> a <span class="list">(<span class="title">x</span>)</span> {</span></div><div class="line">    alert<span class="list">(<span class="title">arguments</span>[<span class="number">0</span>])</span><span class="comment">; // 10</span></div><div class="line">    arguments[<span class="number">0</span>] = <span class="number">20</span><span class="comment">;</span></div><div class="line">    alert<span class="list">(<span class="title">x</span>)</span><span class="comment">; // 20</span></div><div class="line">})<span class="list">(<span class="number">10</span>)</span><span class="comment">;</span></div><div class="line"></div><div class="line"><span class="list">(<span class="title">function</span> a <span class="list">(<span class="title">x</span>)</span> {</span></div><div class="line">    <span class="string">"use strict"</span><span class="comment">;</span></div><div class="line">    alert<span class="list">(<span class="title">arguments</span>[<span class="number">0</span>])</span><span class="comment">; // 10</span></div><div class="line">    arguments[<span class="number">0</span>] = <span class="number">20</span><span class="comment">;</span></div><div class="line">    alert<span class="list">(<span class="title">x</span>)</span><span class="comment">; // 10</span></div><div class="line">})<span class="list">(<span class="number">10</span>)</span><span class="comment">;</span></div></pre></td></tr></table></figure>

<p><strong>arguments 不会指定值</strong></p>
<p>For strict mode functions, if an arguments object is created the binding of the local identifier arguments to the arguments object is immutable and hence may not be the target of an assignment expression. (10.5).</p>
<p><strong>对象不能拥有重名的属性定义，否则会引发 SyntaxError</strong></p>
<p><strong>eval 和 arguments 作为形参会引发 SyntaxError</strong></p>
<p><strong>eval 拥有独立的作用域</strong></p>
<p>这样有三类作用域：全局代码、函数代码、eval 代码，eval 创建的变量不能用于外部。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="pi">　"use strict"</span>;</div><div class="line">　　<span class="keyword">var</span> x = <span class="number">2</span>;</div><div class="line">　　<span class="built_in">console</span>.info(<span class="built_in">eval</span>(<span class="string">"var x = 5; x"</span>)); <span class="comment">// 5</span></div><div class="line">　　<span class="built_in">console</span>.info(x); <span class="comment">// 2</span></div></pre></td></tr></table></figure>

<p><strong>不再将 this 解析为 null 或 undefined 的转换成全局对象</strong></p>
<p>也就是在函数上下文环境下，非引用调用的 this 为 undefined，this 不再指向 window，这样也可避免调用构造函数忘了 new 的问题</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">()</span></span>{</div><div class="line"><span class="pi">　　　　"use strict"</span>;</div><div class="line">　　　　<span class="keyword">this</span>.a = <span class="number">1</span>;</div><div class="line">　　};</div><div class="line">　　f();<span class="comment">// 报错，this未定义</span></div></pre></td></tr></table></figure>

<p><strong>delete 操作符用在变量上会引发 SyntaxError</strong></p>
<p><strong>delete 用在 [[Configurable]]:false 的属性上会引发 TypeError</strong></p>
<p><strong>eval 和 arugments 作为变量标识符，会引发 SyntaxError</strong></p>
<p><strong>不能使用 with 语句</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div><div class="line">　　<span class="keyword">var</span> v = <span class="number">1</span>;</div><div class="line">　　<span class="keyword">with</span> (v){ <span class="comment">// 语法错误 </span></div><div class="line">　　　　v = <span class="number">2</span>;</div><div class="line">　　}</div><div class="line"><span class="comment">// Uncaught SyntaxError: Strict mode code may not include a with statement</span></div></pre></td></tr></table></figure>

<p><strong>函数不能有同名的形参，否则会引发 SyntaxError</strong></p>
<h2 id="问题">问题</h2>
<ul>
<li>我们有一个 ES5 兼容的 JS 环境, 请你完成这段代码, 使变量 a 的值为 global object (即浏览器里的 window), 并判断 console.log 会在控制台输出啥结果</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>{</div><div class="line"><span class="pi">'use strict'</span>;</div><div class="line"><span class="comment">/*</span></div><div class="line">* write your code here</div><div class="line">*/</div><div class="line"><span class="built_in">console</span>.log(a.a === a);</div><div class="line">})();</div></pre></td></tr></table></figure>

<p>结果：false</p>
<ul>
<li>判断是否是严格模式的代码</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="pi">"use strict"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStrictMode</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">return</span> !<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">if</span> (isStrictMode()) {</div><div class="line">    <span class="comment">// ...</span></div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="参考资料">参考资料</h2>
<p><a href="http://www.ecma-international.org/ecma-262/5.1/#sec-C" target="_blank" rel="external">http://www.ecma-international.org/ecma-262/5.1/#sec-C</a><br><a href="http://dmitrysoshnikov.com/ecmascript/es5-chapter-2-strict-mode/" target="_blank" rel="external">http://dmitrysoshnikov.com/ecmascript/es5-chapter-2-strict-mode/</a><br><a href="http://yansong.me/2013/04/21/understand-strict-mode-of-ecma-262-5.html" target="_blank" rel="external">http://yansong.me/2013/04/21/understand-strict-mode-of-ecma-262-5.html</a><br><a href="http://www.ruanyifeng.com/blog/2013/01/javascript_strict_mode.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2013/01/javascript_strict_mode.html</a></p>

            
        </div>

    </div>

    
    
<nav id="article-nav">
  
    <a href="/2013/12/15/ecma_lexical_common_theory/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          词法环境：公共理论
        
      </div>
    </a>
  
  
    <a href="/2013/09/18/js-type-detection/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">JavaScript 类型检测</div>
    </a>
  
</nav>

    

</article>
</section>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 gochant<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    
    
  </div>
  <script src="/js/jquery-1.11.1.min.js" type="text/javascript"></script>

  <script src="/js/dropdown.js" type="text/javascript"></script>

</body>
</html>