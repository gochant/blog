<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>
        
        KendoUI 中的数据源数据绑定 |
        
        GRAVE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <link rel="icon" href="/favicon.png">
    
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">GRAVE</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Living Life Over</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <!--<div id="search-form-wrap">-->
        <!--<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://yoursite.com"></form>-->
      <!--</div>-->
    </div>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/-net/">.net</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ecma-262/">ecma-262</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kendoui/">kendoui</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/veronica/">veronica</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发-团队/">开发 & 团队</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>

  
</aside>
      
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-kendoui-databind-source" class="article article-type-post" itemscope
         itemprop="blogPost">

    <div class="dropdown toc-trigger">
        <a data-toggle="dropdown" href="#">目录</a>
        <div class="dropdown-menu pull-right" role="menu" aria-labelledby="dLabel">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#绑定数据"><span class="toc-number">1.</span> <span class="toc-text">绑定数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据的操作"><span class="toc-number">2.</span> <span class="toc-text">数据的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#获取全部数据"><span class="toc-number">2.1.</span> <span class="toc-text">获取全部数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查找数据"><span class="toc-number">2.2.</span> <span class="toc-text">查找数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加数据"><span class="toc-number">2.3.</span> <span class="toc-text">添加数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除数据"><span class="toc-number">2.4.</span> <span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#修改数据"><span class="toc-number">2.5.</span> <span class="toc-text">修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他操作"><span class="toc-number">2.6.</span> <span class="toc-text">其他操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一些坑"><span class="toc-number">3.</span> <span class="toc-text">一些坑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol>
        </div>
    </div>

    <div class="article-inner">
        

        
        <header class="article-header">
            
  
    <h1 class="article-title" itemprop="name">
      KendoUI 中的数据源数据绑定
    </h1>
  

        </header>
        

        <div class="article-meta">
            <a href="/2013/12/25/kendoui-databind-source/" class="article-date">
  <time datetime="2013-12-25T03:19:07.000Z" itemprop="datePublished">Dec 25 2013</time>
</a>
            
  <div class="article-category">
    <a class="article-category-link" href="/categories/kendoui/">kendoui</a>
  </div>

        </div>

        <hr/>

        <div class="article-entry" itemprop="articleBody">
            
            <p>在 KendoUI 的 MVVM 数据绑定机制中，许多控件，如ListView、Grid、DropDownList 可以指定 <code>source</code> 属性为该控件绑定一个数据集合，以便显示多条数据。这里所绑定的数据源我把它们分为三种：</p>
<ul>
<li>原生数组</li>
<li>ObservableArray 对象</li>
<li>kendo.data.DataSource 对象</li>
</ul>
<p>三种数据源的初始化方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Native Array</span></div><div class="line"><span class="keyword">var</span> bindData = [<span class="string">'foo'</span>, <span class="string">'bar'</span>];</div><div class="line"></div><div class="line"><span class="comment">// ObservableArray</span></div><div class="line"><span class="keyword">var</span> bindData = <span class="keyword">new</span> kendo.data.ObservableArray([<span class="string">'foo'</span>, <span class="string">'bar'</span>]);</div><div class="line"></div><div class="line"><span class="keyword">var</span> bindData = kendo.observable({</div><div class="line">    test: [<span class="string">'foo'</span>, <span class="string">'bar'</span>]</div><div class="line">});</div><div class="line"></div><div class="line"><span class="comment">// DataSource</span></div><div class="line"><span class="keyword">var</span> bindData = <span class="keyword">new</span> kendo.data.DataSource({</div><div class="line">    data: [<span class="string">"foo"</span>, <span class="string">"bar"</span>]</div><div class="line">});</div></pre></td></tr></table></figure>

<p>当调用 <code>kendo.observable</code> 方法时，会将对象中数组类型的属性转换成 ObservableArray 对象，另外，在 DataSource 内部，也会创建 ObservableArray 对象。</p>
<blockquote>
<p>在 veronica 中的 view 中，调用 model 方法会将普通对象转换成 observable 对象，设置到 viewModel 上。</p>
</blockquote>
<p>三种数据源对比</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>绑定方式</th>
<th>远程数据支持</th>
</tr>
</thead>
<tbody>
<tr>
<td>NativeArray</td>
<td>单向（界面-&gt;数据）</td>
<td>否</td>
</tr>
<tr>
<td>ObservableArray</td>
<td>双向</td>
<td>否</td>
</tr>
<tr>
<td>DataSource</td>
<td>双向</td>
<td>是</td>
</tr>
</tbody>
</table>
<p>因此，如果仅是本地数据源，那么使用 ObservableArray 即可，并且大多数时候，数组都是作为对象的属性存在，因此可使用 <code>kendo.observable</code> 方法，将普通对象转换成可双向绑定的对象。</p>
<p>当数据来源是远程后台时，应该创建一个 DataSource 对象，并配置相关的属性。</p>
<h2 id="绑定数据">绑定数据</h2>
<p>从数据呈现上，绑定两者基本上没什么区别：</p>
<p>HTML:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">data-role</span>=<span class="value">"listview"</span> <span class="attribute">data-bind</span>=<span class="value">"source: pureArray"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">data-role</span>=<span class="value">"listview"</span> <span class="attribute">data-bind</span>=<span class="value">"source: dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>

<p>JS:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> viewModel = {</div><div class="line">    pureArray: [<span class="string">"foo"</span>, <span class="string">"bar"</span>],</div><div class="line">    dataSource: <span class="keyword">new</span> kendo.data.DataSource({</div><div class="line">        data: [<span class="string">"foo"</span>, <span class="string">"bar"</span>]</div><div class="line">    })</div><div class="line">};</div><div class="line"></div><div class="line">kendo.bind($(<span class="string">'body'</span>), viewModel);</div></pre></td></tr></table></figure>

<h2 id="数据的操作">数据的操作</h2>
<p>这里主要讨论 ObservableArray 和 DataSource 在数据操作时相关API的差异。</p>
<h3 id="获取全部数据">获取全部数据</h3>
<p>ObservableArray：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">thisArray.toJSON();</div></pre></td></tr></table></figure>

<p>DataSource：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">thisSource.data().toJSON();</div></pre></td></tr></table></figure>

<h3 id="查找数据">查找数据</h3>
<ul>
<li>根据 index 查找</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ObservableArray</span></div><div class="line">thisArray[index];</div><div class="line"></div><div class="line"><span class="comment">// DataSource</span></div><div class="line">thisSource.at(index);</div></pre></td></tr></table></figure>

<ul>
<li>根据某个特定的值查找</li>
</ul>
<p>ObservableArray</p>
<p>提供了一个 <code>find</code> 方法，可以自定义查找逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 查找 Uid</span></div><div class="line"><span class="keyword">var</span> item = thisArray.find(<span class="function"><span class="keyword">function</span><span class="params">(item, index, context)</span></span>{</div><div class="line">    <span class="keyword">return</span> item.uid === uid;</div><div class="line">});</div><div class="line"><span class="comment">// 查找 id</span></div><div class="line"><span class="keyword">var</span> item = thisArray.find(<span class="function"><span class="keyword">function</span><span class="params">(item, index, context)</span></span>{</div><div class="line">    <span class="keyword">return</span> item.uid === uid;</div><div class="line">});</div></pre></td></tr></table></figure>

<p>DataSource</p>
<p>为不同的查找提供了不同的方法，调用更加简单。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 根据 uid 查找</span></div><div class="line"><span class="keyword">var</span> item = thisSource.getByUid(uid);</div><div class="line"><span class="comment">// 根据 id 查找</span></div><div class="line"><span class="keyword">var</span> item = thisSource.get(id);</div><div class="line"><span class="comment">// 单字段查找</span></div><div class="line"><span class="keyword">var</span> item = thisSource.filter({</div><div class="line">    field: <span class="string">"name"</span>,</div><div class="line">    operator: <span class="string">"startswith"</span>,</div><div class="line">    value: <span class="string">"Jane"</span></div><div class="line">});</div><div class="line"><span class="comment">// 组合查询</span></div><div class="line"><span class="keyword">var</span> item = thisSource.filter([</div><div class="line">    { field: <span class="string">"category"</span>, operator: <span class="string">"eq"</span>, value: <span class="string">"Beverages"</span> },</div><div class="line">    { field: <span class="string">"name"</span>, operator: <span class="string">"neq"</span>, value: <span class="string">"Coffee"</span> }</div><div class="line">]);</div><div class="line"><span class="comment">//  分字段查询</span></div><div class="line"><span class="keyword">var</span> item = thisSource.filter({</div><div class="line">    logic: <span class="string">"or"</span>,</div><div class="line">    filters: [</div><div class="line">      { field: <span class="string">"category"</span>, operator: <span class="string">"eq"</span>, value: <span class="string">"Food"</span> },</div><div class="line">      { field: <span class="string">"name"</span>, operator: <span class="string">"eq"</span>, value: <span class="string">"Tea"</span> }</div><div class="line">    ]</div><div class="line">});</div></pre></td></tr></table></figure>

<h3 id="添加数据">添加数据</h3>
<p>两者均支持添加到头、尾及任意 index 的方法</p>
<p>ObservableArray</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 添加到尾部</span></div><div class="line">dataSource.push({ name: <span class="string">"John Doe"</span>, age: <span class="number">33</span> });</div><div class="line"><span class="comment">// 添加到头部</span></div><div class="line">dataSource.unshift({ name: <span class="string">"John Doe"</span> });</div><div class="line"><span class="comment">// 添加到指定位置</span></div><div class="line">dataSource.splice(index, <span class="number">0</span>, { name: <span class="string">"John Doe"</span> }, { name: <span class="string">"Channing"</span> });</div></pre></td></tr></table></figure>

<p>DataSource</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 添加到尾部</span></div><div class="line">dataSource.add({ name: <span class="string">"John Doe"</span>, age: <span class="number">33</span> });</div><div class="line"><span class="comment">// 添加到头部</span></div><div class="line"><span class="keyword">var</span> dataItem = dataSource.insert(<span class="number">0</span>, { name: <span class="string">"John Doe"</span> });</div><div class="line"><span class="comment">// 添加到任意位置</span></div><div class="line">dataSource.insert(index, { name: <span class="string">"John Doe"</span> });</div></pre></td></tr></table></figure>

<h3 id="删除数据">删除数据</h3>
<p>ObservableArray</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 万能的方法</span></div><div class="line">source.splice(start, end);</div><div class="line"></div><div class="line">source.remove(item);</div><div class="line">source.pop();</div><div class="line">source.shift();</div><div class="line">source.empty();</div></pre></td></tr></table></figure>

<p>DataSource</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> item = source.at(<span class="number">0</span>);</div><div class="line">source.remove(item);</div></pre></td></tr></table></figure>

<h3 id="修改数据">修改数据</h3>
<p>ObservableArray 和 DataSource 的每一个数据项都是 ObservableObject 对象，因此获取到数据项后，对其的修改操作可及时反应到界面上。</p>
<h3 id="其他操作">其他操作</h3>
<p>现成的排序、分组、聚合等高级功能只有 DataSource 支持</p>
<h2 id="一些坑">一些坑</h2>
<ul>
<li>kendo.ui.Pager 控件在绑定数组作为数据源时，如果不指定当前页数，会出现显示上的错误。</li>
</ul>
<blockquote>
<p>解决方案：应避免在使用本地数据时，使用 Pager 控件，或者改用 DataSource 数据源，指定当前页。</p>
</blockquote>
<ul>
<li>DropDownList、Combobox 控件在绑定非对象数组时（如字符串数组），多次绑定（即使在bind之前 unbind）会导致第二次绑定下拉列表中显示值不正确。</li>
</ul>
<blockquote>
<p>解决方案：在可能会二次绑定的地方，使用对象数组绑定，并手动设置 <code>data-text-filed</code> 和 <code>data-value-field</code>。</p>
</blockquote>
<h2 id="总结">总结</h2>
<ul>
<li>我们通常不绑定普通数组，仅当只是用来纯显示时才考虑；</li>
<li>本地数组绑定，优先采用 ObservableArray， 它提供了类似于原生数组的操作方法，操作本地数据更方便；</li>
<li>DataSource 仅用于绑定远程数组时使用，但如果本地数据要求组合排序、分组等高级功能，也可考虑使用DataSource替代ObservableArray。</li>
</ul>

            
        </div>

    </div>

    
    
<nav id="article-nav">
  
    <a href="/2014/02/19/frontend-backend-divided-dev/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          前后端分离调试开发
        
      </div>
    </a>
  
  
    <a href="/2013/12/18/js-string-basic/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">字符串：基础</div>
    </a>
  
</nav>

    

</article>
</section>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 gochant<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    
    
  </div>
  <script src="/js/jquery-1.11.1.min.js" type="text/javascript"></script>

  <script src="/js/dropdown.js" type="text/javascript"></script>

</body>
</html>